#!/bin/sh

MAX=0
MIN=0
CUR=0
N=0

for i in $(find '/sys/devices/system/cpu/cpufreq/' -maxdepth 1 -type d -name 'policy*') ; do
    CPU_MAX=$(cat $i/scaling_max_freq)
    CPU_MIN=$(cat $i/scaling_min_freq)
    CPU_CUR=$(cat $i/scaling_cur_freq)
    MAX=$(echo "$MAX + $CPU_MAX" | bc)
    MIN=$(echo "$MIN + $CPU_MIN" | bc)
    CUR=$(echo "$CUR + $CPU_CUR" | bc)
    N=$(echo "$N + 1" | bc)
done

MAX=$(echo "$MAX / $N" | bc)
MIN=$(echo "$MIN / $N" | bc)
CUR=$(echo "$CUR / $N" | bc)
if [ -n "$1" ] ; then
    p="$1";
else
    p="5";
fi

cmd="scale=$p;100 * ($CUR - $MIN) / ($MAX - $MIN)"
echo "$cmd" | bc
